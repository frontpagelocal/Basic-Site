(function($){Drupal.behaviors.zoomimage={attach:function(context,settings){$('a.imagezoom',context).click(function(e){e.preventDefault()});$('li.imagezoom-thumb-image',context).click(function(e){swap(e,$(this))});switch(settings.imagezoom.zoom_type){case'popup':$('a.imagezoom',context).mouseenter(function(e){zoom_popup($(this))});$('a.imagezoom',context).mousemove(function(e){shift(e,$(this))});$('a.imagezoom',context).mouseleave(function(e){reset()});break;case'inner':$('a.imagezoom',context).mouseenter(function(e){zoom_inner($(this))});$('a.imagezoom',context).mousemove(function(e){shift(e,$(this))});$('a.imagezoom',context).mouseleave(function(e){reset()});break}function zoom_popup(obj){var zoomImageWrapper,zoomImage,title;zoomImageWrapper=$('<div/>',{'id':'zoom-img-wrapper','class':'popup'});zoomImage=$('<img/>',{'src':obj.attr('href'),'id':'zoom-img'});zoomImageWrapper.appendTo(obj.parent());zoomImage.appendTo('#zoom-img-wrapper');if(settings.imagezoom.display_title==1){title='<div class="zoom-img-title">'+obj.children('img').attr('title')+'</div>';zoomImageWrapper.append(title)}$('#zoom-img-wrapper',context).parent('div').css('position','relative')}function zoom_inner(obj){var image,zoomImageWrapper,zoomImage;image=obj.children('img');obj.css({'position':'relative','display':'block','height':image.height(),'width':image.width()});zoomImageWrapper=$('<div/>',{'id':'zoom-img-wrapper','class':'inner'});zoomImageWrapper.css({'height':image.height(),'width':image.width()});zoomImage=$('<img/>',{src:obj.attr('href'),id:'zoom-img'});zoomImageWrapper.appendTo(obj);zoomImage.appendTo('#zoom-img-wrapper')}function reset(){$('#zoom-img-wrapper',context).remove()}function shift(e,obj){var image,zoomImage,offset,mouseX,mouseY,ratioX,ratioY,posX,posY;image=obj.children('img');zoomImage=$('#zoom-img',context);offset=image.offset();mouseX=e.pageX-offset.left;mouseY=e.pageY-offset.top;ratioX=(zoomImage.width()-$('#zoom-img-wrapper',context).width())/image.width();ratioY=(zoomImage.height()-$('#zoom-img-wrapper',context).height())/image.height();posX=mouseX*ratioX;posY=mouseY*ratioY;if(posX>zoomImage.width()){posX=zoomImage.width()}if(posY>zoomImage.height()){posY=zoomImage.height()}$('#zoom-img',context).css('left',(posX*-1)+'px');$('#zoom-img',context).css('top',(posY*-1)+'px')}function swap(e,obj){e.preventDefault();var mainSrc,zoomSrc,thumbSrc,newMainSrc,newZoomSrc,pos;mainSrc=$('a.imagezoom img',context).attr('src');pos=mainSrc.lastIndexOf('/');mainSrc=mainSrc.substr(0,pos)+'/';zoomSrc=$('a.imagezoom',context).attr('href');pos=zoomSrc.lastIndexOf('/');zoomSrc=zoomSrc.substr(0,pos)+'/';thumbSrc=obj.children('a').children('img').attr('src');pos=thumbSrc.lastIndexOf('/');thumbSrc=thumbSrc.substr(pos+1);newMainSrc=mainSrc+thumbSrc;newZoomSrc=zoomSrc+thumbSrc;$('a.imagezoom img',context).attr('src',newMainSrc);$('a.imagezoom',context).attr('href',newZoomSrc);$('li.imagezoom-thumb-image.active',context).removeClass('active');obj.addClass('active');if(settings.imagezoom.hide_thumbs==1){$('li.imagezoom-thumb-image.imagezoom-thumb-hide',context).removeClass('imagezoom-thumb-hide');obj.addClass('imagezoom-thumb-hide')}}}}})(jQuery);
